# APMTree
分布式系统跟踪技术

英文原文：
https://storage.googleapis.com/pub-tools-public-publication-data/pdf/40378.pdf

中文翻译
https://www.jianshu.com/p/7c719a75df8c

<pre>
Google dapper阅读笔记

      三大设计目标

        1：低消耗
           跟踪系统对在线服务的影响应该做到足够小。在一些高度优化过的服务，即使一点点损耗也
           回很容易察觉到，而且有可能迫使在线服务的部署团队不得不将跟踪系统关停
        2：应用级的透明
           对于应用的程序员来说，是不需要知道有跟踪系统这回事的。如果一个跟踪系统想生效，就
           必须要依赖应用的开发者主动配合，那么这个跟踪系统也太脆弱了，往往由于跟踪系统在
           应用中植入代码的bug或疏忽导致应用出问题，这样才是无法满足对跟踪系统“无所不在的
           部署”这个需求。面对当下像Google这样的快节奏的开发环境来说，尤其重要。
        3：延展性
           Google至少在未来几年的服务和集群的规模，监控系统都应该能完全把握住。
        
        一个额外的设计目标是：
               为跟踪数据产生后，进行分析的速度要快，理想情况是数据存入跟踪仓库后，一分钟
            就能统计出来。   
</pre>

![](https://i.imgur.com/Ra6ydIH.png)

<pre>
前端:A
中间层：B, C
后端： D, E
      当一个用户发起一个请求时，首先到达前端，然后发送两个RPC到服务器B和C。B会马上做出反应
   ，但是C需要和后端的D和E交互之后再返回给A，由A来相应最初的请求。
</pre>

![](https://i.imgur.com/KQP6867.png)

<pre>
跟踪树和span
    span的ID和跟踪的ID会从客户端发送到服务器端。
</pre>

Dapper收集管道总览

![](https://i.imgur.com/2Y8wsbT.png)

<pre>
跟踪的收集
    Dapper的跟踪记录和收集管道的过程分为三个过程。
    （1）跟踪日子写入本地日志文件
    （2）Dapper守护进程和收集组件把这些数据从生产环境的主机中拉出
    （3）存储BigTable中
 
     一次跟踪被设计成BigTable中的一行，每一列相当于一个span。
</pre>